<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.mapper/ProductMapper">

	
	<select id="productSelect" parameterType="int" resultType="ProductVO">
	SELECT
   	product_code,
    category_code,
    parents_code,
    product_name,
    product_price,
    product_discount,
    product_company,
    product_inform,
    product_image,
    product_amount,
    product_event,
    PRODUCT_DIsPLAY,
    product_createdate,
    product_update
	FROM
    product_tbl
    WHERE
    product_code = #{code}
	</select>

	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 'name'.toString()">
				and product_name like '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'inform'.toString()">
				and product_inform like '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'price'.toString()">
				and product_price like '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'nainform'.toString()">
				<![CDATA[
				and (product_name like '%' || #{keyword} || '%'
				or
				product_inform like '%' || #{keyword} || '%')
				]]>
			</if>
		</if>
		<if test="searchType == null">
		</if>
	</sql>

	<select id="proCount" parameterType="CategoryCriteria"
		resultType="int">
		<![CDATA[
		select count(product_code) from product_tbl
		]]>
		where category_code = #{subCategory}
		<include refid="search" />
		and PRODUCT_DIsPLAY = 'Y'
	</select>
	
	<select id="productList" parameterType="CategoryCriteria"
		resultType="ProductVO">
		select product_code,
		CATEGORY_CODE, PARENTS_CODE, PRODUCT_NAME,
		PRODUCT_PRICE,
		PRODUCT_DISCOUNT, PRODUCT_COMPANY, PRODUCT_INFORM,
		PRODUCT_IMAGE,PRODUCT_EVENT,
		PRODUCT_AMOUNT, PRODUCT_DIsPLAY, PRODUCT_CREATEDATE,
		PRODUCT_UPDATE

		from(select product_code, CATEGORY_CODE, PARENTS_CODE,
		PRODUCT_NAME,
		PRODUCT_PRICE, PRODUCT_DISCOUNT, PRODUCT_COMPANY,
		PRODUCT_INFORM,PRODUCT_EVENT,
		PRODUCT_IMAGE, PRODUCT_AMOUNT, PRODUCT_DIsPLAY,
		PRODUCT_CREATEDATE,
		PRODUCT_UPDATE, row_number() over(order by
		product_code desc) pro_seq from
		product_tbl
		where category_code = #{subCategory}
		and PRODUCT_DIsPLAY = 'Y'
		<include refid="search" />
		)

		where pro_seq between #{rowStart} and #{rowEnd}

	</select>
	
	<sql id="homeSearch">
		<if test="mainCategory != null">
			<if test="mainCategory != ''.toString()">
				<if test="subCategory == ''.toString()">
					and PARENTS_CODE = #{mainCategory}
				</if>
				<if test="subCategory != ''.toString()">
					and CATEGORY_CODE = #{subCategory}
				</if>
			
				<if test="searchType != null">
					<if test="searchType == 'name'.toString()">
						and product_name like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'inform'.toString()">
						and product_inform like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'price'.toString()">
						and product_price like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'nainform'.toString()">
						<![CDATA[
						and (product_name like '%' || #{keyword} || '%'
						or
						product_inform like '%' || #{keyword} || '%')
						]]>
					</if>
				</if>
			</if>
			<if test="mainCategory == ''.toString()">
				<if test="searchType != null">
					<if test="searchType == 'name'.toString()">
						and product_name like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'inform'.toString()">
						and product_inform like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'price'.toString()">
						and product_price like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'nainform'.toString()">
						<![CDATA[
						and (product_name like '%' || #{keyword} || '%'
						or
						product_inform like '%' || #{keyword} || '%')
						]]>
					</if>
				</if>
			</if>
		</if>
	</sql>

	<select id="homeProList" parameterType="CategoryCriteria"
		resultType="ProductVO">
		select product_code,
		CATEGORY_CODE, PARENTS_CODE, PRODUCT_NAME,
		PRODUCT_PRICE,
		PRODUCT_DISCOUNT, PRODUCT_COMPANY, PRODUCT_INFORM,
		PRODUCT_IMAGE,PRODUCT_EVENT,
		PRODUCT_AMOUNT, PRODUCT_DIsPLAY, PRODUCT_CREATEDATE,
		PRODUCT_UPDATE

		from(select product_code, CATEGORY_CODE, PARENTS_CODE,
		PRODUCT_NAME,
		PRODUCT_PRICE, PRODUCT_DISCOUNT, PRODUCT_COMPANY,
		PRODUCT_INFORM,PRODUCT_EVENT,
		PRODUCT_IMAGE, PRODUCT_AMOUNT, PRODUCT_DIsPLAY,
		PRODUCT_CREATEDATE,
		PRODUCT_UPDATE, row_number() over(order by
		product_code desc) pro_seq 
		from product_tbl
		where PRODUCT_DIsPLAY = 'Y'
		<include refid="homeSearch" />
		)

		where pro_seq between #{rowStart} and #{rowEnd}

	</select>

	<select id="homeCount" parameterType="SearchCriteria"
		resultType="int">
		<![CDATA[
		select count(product_code) from product_tbl
		where PRODUCT_DIsPLAY = 'Y'
		
		]]>
		<include refid="homeSearch" />
	</select>
	
</mapper>