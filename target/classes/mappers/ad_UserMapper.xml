<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.mapper/Ad_UserMapper">

	<select id="userList" parameterType="SearchCriteria" resultType="UserListVO">
		select * from
			(select u.user_id,u.user_name,u.user_point,u.user_createdate,u.user_update,nvl(o.order_count,0) order_count ,nvl(o.total_price,0) total_price, ROW_number() over (order by u.user_createdate desc) num
			from users_tbl u left join 
				(select u.user_id, count(o.order_code) order_count , sum(o.order_sumprice) total_price
				from users_tbl u , order_tbl o
				where u.user_id = o.user_id 
				group by u.user_id
				) o
			on u.user_id = o.user_id)
		where num between #{rowStart} and #{rowEnd}
	</select>
	
	<select id="userdetail" parameterType="string" resultType="UserVO">
		select user_id, USER_NAME, USER_POSTCODE, USER_ADDRESS, USER_DETAILADDR, USER_PHONENUM, USER_EMAIL,user_mail_check
		from users_tbl
		where user_id = #{user_id}
	</select>
	
	<select id="getEmail" parameterType="map" resultType="UserVO">
	select user_id,user_email from users_tbl where user_mail_check = 'Y'
	and user_id =
	<foreach collection="ids" item="id" index="index" open="any(" separator="," close=")">#{id}</foreach>
	</select>
	
	<select id="allEmail" resultType="UserVO">
		select user_id,user_email from users_tbl where user_mail_check = 'Y'
	</select>
	
	<delete id="userDelete" parameterType="string">
	delete from users_tbl where user_id = #{id}
	</delete>
	
	<delete id="checkDelete" parameterType="map">
	delete from users_tbl where user_id = 
	<foreach collection="ids" item="id" index="index" open="any(" separator="," close=")">#{id}</foreach>
	</delete>
	
	<select id="countUser" resultType="int">
		select count(user_id) from users_tbl
	</select>
</mapper>