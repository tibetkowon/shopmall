<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.mapper/Ad_ProductMapper">

	<select id="categoryList" resultType="CategoryVO">
		select category_code,
		PARENTS_CODE, CATEGORY_NAME from category_tbl where parents_code is
		null
	</select>

	<select id="subCateList" parameterType="string"
		resultType="CategoryVO">
		select category_code, PARENTS_CODE, CATEGORY_NAME from
		category_tbl where parents_code = #{mainCate}
	</select>

	<insert id="productInsert" parameterType="ProductVO">
		INSERT INTO
		PRODUCT_TBL(product_code, CATEGORY_CODE, parents_code, product_NAME,
		product_PRICE,
		product_DISCOUNT, product_COMPANY, product_INFORM,
		product_IMAGE, product_AMOUNT, product_event,
		PRODUCT_DIsPLAY)
		VALUES
		(seq_product_id.nextval,#{category_code},#{parents_code},#{product_name},#{product_price},#{product_discount},#{product_company},#{product_inform},#{product_image},#{product_amount},#{product_event},#{product_PRODUCT_DIsPLAY})
	</insert>

	<!-- 검색문 -->
	<sql id="search">
		<if test="mainCategory != null">
			<if test="mainCategory != ''.toString()">
				<if test="subCategory == ''.toString()">
					where PARENTS_CODE = #{mainCategory}
				</if>
				<if test="subCategory != ''.toString()">
					where CATEGORY_CODE = #{subCategory}
				</if>
			
				<if test="searchType != null">
					<if test="searchType == 'name'.toString()">
						and product_name like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'inform'.toString()">
						and product_inform like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'price'.toString()">
						and product_price like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'nainform'.toString()">
						<![CDATA[
						and (product_name like '%' || #{keyword} || '%'
						or
						product_inform like '%' || #{keyword} || '%')
						]]>
					</if>
				</if>
			</if>
			<if test="mainCategory == ''.toString()">
				<if test="searchType != null">
					<if test="searchType == 'name'.toString()">
						where product_name like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'inform'.toString()">
						where product_inform like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'price'.toString()">
						where product_price like '%' || #{keyword} || '%'
					</if>
					<if test="searchType == 'nainform'.toString()">
						where product_name like '%' || #{keyword} || '%'
						or
						product_inform like '%' || #{keyword} || '%'
					</if>
				</if>
			</if>
		</if>
	</sql>

	<select id="productList" parameterType="CategoryCriteria"
		resultType="ProductVO">
		select product_code,
		CATEGORY_CODE, PARENTS_CODE, PRODUCT_NAME,
		PRODUCT_PRICE,
		PRODUCT_DISCOUNT, PRODUCT_COMPANY, PRODUCT_INFORM,
		PRODUCT_IMAGE,PRODUCT_EVENT,
		PRODUCT_AMOUNT, PRODUCT_DIsPLAY, PRODUCT_CREATEDATE,
		PRODUCT_UPDATE

		from(select product_code, CATEGORY_CODE, PARENTS_CODE,
		PRODUCT_NAME,
		PRODUCT_PRICE, PRODUCT_DISCOUNT, PRODUCT_COMPANY,
		PRODUCT_INFORM,PRODUCT_EVENT,
		PRODUCT_IMAGE, PRODUCT_AMOUNT, PRODUCT_DIsPLAY,
		PRODUCT_CREATEDATE,
		PRODUCT_UPDATE, row_number() over(order by
		product_code desc) pro_seq from
		product_tbl
		<include refid="search" />
		)

		where pro_seq between #{rowStart} and #{rowEnd}

	</select>

	<select id="proCount" parameterType="SearchCriteria"
		resultType="int">
		select count(product_code) from product_tbl
		<include refid="search" />
	</select>

	<select id="productRead" parameterType="int"
		resultType="ProductVO">
		select product_code, CATEGORY_CODE, PARENTS_CODE,
		PRODUCT_NAME,
		PRODUCT_PRICE, PRODUCT_DISCOUNT, PRODUCT_COMPANY,
		PRODUCT_INFORM,
		PRODUCT_IMAGE, PRODUCT_AMOUNT, PRODUCT_DIsPLAY,
		PRODUCT_CREATEDATE,
		PRODUCT_UPDATE, PRODUCT_EVENT
		from product_tbl
		where
		product_code = #{product_code}
	</select>

	<update id="modify" parameterType="ProductVO">
		update product_tbl set
		parents_code = #{parents_code},
		product_name = #{product_name},
		product_price = #{product_price},
		product_discount = #{product_discount},
		product_company = #{product_company},
		product_inform = #{product_inform},
		product_amount = #{product_amount},
		product_image = #{product_image},
		PRODUCT_DIsPLAY = #{PRODUCT_DIsPLAY},
		product_update = SYSDATE,
		product_event = #{product_event},
		category_code = #{category_code}
		where product_code = #{product_code}
	</update>
	
	<update id="quickModify" parameterType="productDTO">
	 update product_tbl set
	 product_price = #{price},
	 product_name = #{name},
	 PRODUCT_DIsPLAY = #{buy},
	 product_amount = #{amount},
	 product_update = SYSDATE
	 where product_code = #{code}
	</update>


	<select id="selectImage" parameterType="int" resultType="string">
		select product_image from product_tbl where product_code = #{product_code}
	</select>
	
	<delete id="delete" parameterType="int">
		delete from product_tbl where product_code = #{product_code}
	</delete>
	
		
	<select id="count_QnA" parameterType="int" resultType="HashMap">
		select count(board_num) count,product_code
		from board_tbl
		where board_reply = 'N'
		group by product_code
	</select>
	
	<select id="QnAList" resultType="QnADTO" parameterType="Criteria">
		select b.product_code,board_num,board_title,board_createday,b.user_id,board_reply,num,p.product_name
		from (select product_code,board_num,board_title,board_createday,user_id,board_reply,row_number() over(order by board_createday desc) num
		from board_tbl) b , product_tbl p
		where p.product_code = b.product_code
		and num between #{rowStart} and #{rowEnd}
	</select>
	
	<select id="totalQnA" resultType="int">
		select count(board_num) from board_tbl
	</select>
	
	<select id="readQnA" parameterType="int" resultType="QnADTO">
		select board_num,board_title,board_content,user_id,b.product_code,product_name,product_price,product_inform,product_amount,product_image,product_event
	from board_tbl b, product_tbl p
	where b.product_code = p.product_code
	and board_num = #{board_num}
	</select>
</mapper>